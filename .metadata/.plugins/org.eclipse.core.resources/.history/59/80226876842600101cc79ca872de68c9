<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{user/layout/head::head}"></head>
<body>

	<header th:replace="~{user/layout/header::header}"></header>

	<main>
		<div class="main-container">
			<div class="main-section">
				<section class="sidebar-list">
					<div class="header-topic">
						<h3>Phần 1: Mô tả tranh</h3>
					</div>
					<div class="list-topic">
						<ul th:each="part1ListeningExerciseOfList : ${list}">
							<li><a
								th:href="@{|/user/part1-listening-exercise/${part1ListeningExerciseOfList.id}|}"
								th:text="${part1ListeningExerciseOfList.exerciseName}"></a></li>
						</ul>
					</div>
				</section>

				<section class="main-content">
					<div class="main-list-question">
						<div class="question-detail"
							th:each="part1 : ${part1ListeningExercise.part1s}">
							<div class="ques-audio">
								<h3 th:text="'Câu hỏi ' + ${part1.number}"></h3>
								<audio controls>
									<source th:src="${part1.audioUrl}" type="audio/mpeg">
								</audio>
							</div>
							<div class="ques-photo">
								<img th:src="${part1.imageUrl}" alt="">
							</div>
							<div class="main-answer">
								<div class="choose-ans">
									<div>
										<input type="radio" name="question-${part1.id}"
											id="optionA-${part1.id}" value="A"> <label
											for="optionA-${part1.id}" data-option="A"
											th:text="${part1.optionA}"></label>
									</div>
									<div>
										<input type="radio" name="question-${part1.id}"
											id="optionB-${part1.id}" value="B"> <label
											for="optionB-${part1.id}" data-option="B"
											th:text="${part1.optionB}"></label>
									</div>
									<div>
										<input type="radio" name="question-${part1.id}"
											id="optionC-${part1.id}" value="C"> <label
											for="optionC-${part1.id}" data-option="C"
											th:text="${part1.optionC}"></label>
									</div>
									<div>
										<input type="radio" name="question-${part1.id}"
											id="optionD-${part1.id}" value="D"> <label
											for="optionD-${part1.id}" data-option="D"
											th:text="${part1.optionD}"></label>
									</div>
								</div>
								<div class="check-ans" style="display: none;">
									<div class="ans-detail">
										<div>
											<h3>Đáp án đúng:</h3>
											<span th:text="${part1.correctAnswer}"></span>
										</div>
										<div>
											<span>Bản dịch: </span>
											<p
												th:utext="${#strings.replace(part1.explanation, '.', '.<br>')}"></p>
										</div>
									</div>
									<button class="hide-explanation">Ẩn giải thích</button>
								</div>
							</div>
						</div>
					</div>
				</section>
			</div>
		</div>
	</main>

	<script>
document.addEventListener("DOMContentLoaded", function () {
  document.querySelectorAll(".question-detail").forEach((question) => {
    const answers = question.querySelectorAll("input[type='radio']");
    const checkAns = question.querySelector(".check-ans");
    const correctAnswer = question.querySelector(".ans-detail span").textContent.trim();
    const hideButton = question.querySelector(".hide-explanation");

    checkAns.style.display = "none";

    answers.forEach((answer) => {
      answer.addEventListener("change", function () {
        checkAns.style.display = "block";

        const labels = question.querySelectorAll(".choose-ans label");
        labels.forEach((label) => {
          label.style.color = "";
          label.innerHTML = label.innerHTML.replace("✔️", "").replace("❌", "");
        });

        const selectedLabel = question.querySelector(`label[for="${answer.id}"]`);
        const selectedOption = selectedLabel.getAttribute("data-option");

        if (selectedOption === correctAnswer) {
          selectedLabel.style.color = "green";
          selectedLabel.innerHTML += " ✔️";
        } else {
          selectedLabel.style.color = "red";
          selectedLabel.innerHTML += " ❌";

          const correctLabel = question.querySelector(`label[data-option="${correctAnswer}"]`);
          if (correctLabel) {
            correctLabel.style.color = "green";
            correctLabel.innerHTML += " ✔️";
          }
        }
      });
    });

    hideButton.addEventListener("click", function () {
      checkAns.style.display = "none";
    });
  });
});
</script>

</body>
</html>
