<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{user/layout/head::head}"></head>
<script>
	document
			.addEventListener(
					"DOMContentLoaded",
					function() {
						function showSection(section) {
							document.querySelector('.user-info').style.display = 'none';
							document.querySelector('.user-history-test').style.display = 'none';
							document.querySelector('.user-password').style.display = 'none';
							document.querySelector(section).style.display = 'block';
						}

						window.showSection = showSection; // ƒê·∫£m b·∫£o h√†m c√≥ th·ªÉ g·ªçi t·ª´ HTML
					});
</script>

<body>

	<header th:replace="~{user/layout/header::header}"></header>

	<main>
		<div class="main-container">
			<div class="user-profile">
				<section class="sidebar-user">
					<ul>
						<li><a th:href="@{/user/account-information?information}"
							onclick=" event.preventDefault(); showSection('.user-info')"><i
								class="fa fa-user"></i>Th√¥ng tin t√†i kho·∫£n</a></li>
						<li><a th:href="@{/user/account-information?history-test}"
							onclick="event.preventDefault(); showSection('.user-history-test')"><i
								class="fa fa-clock"></i>L·ªãch s·ª≠ h·ªçc t·∫≠p</a></li>
						<li><a th:href="@{/user/account-information?changepass}"
							onclick=" event.preventDefault(); showSection('.user-password')"><i
								class="fa fa-key"></i>ƒê·ªïi m·∫≠t kh·∫©u</a></li>
					</ul>
				</section>

				<section class="user-info user-maincontent">
					<div class="user-info-container">
						<div class="user-info-header">
							<h3>Th√¥ng tin t√†i kho·∫£n</h3>
						</div>
						<form method="post" action="/user/account-information/update"
							th:action="@{/user/account-information/update}">
							<div class="div">
								<label for="username">Username</label> <input type="text"
									th:value="${currentUserUsername}" id="username" name="username">
							</div>
							<div class="div">
								<label for="email">Email</label> <input type="email"
									th:value="${currentUserEmail}" id="email" name="email" readonly>
							</div>
							<div class="div">
								<button class="update" type="submit">C·∫≠p nh·∫≠t</button>
							</div>
						</form>
					</div>
				</section>

				<section class="user-history-test user-maincontent"
					style="display: none">
					<div class="user-info-container">
						<div class="user-info-header">
							<h3>L·ªãch s·ª≠ l√†m b√†i</h3>
						</div>
						<div class="card-custom">
							<div class="search-box">
								<input type="text" class="form-control"
									placeholder="üîç T√¨m ki·∫øm..."> <input type="date"
									class="form-control" placeholder="üìÖ L·ªçc theo ng√†y">
							</div>
							<table class="table table-bordered text-center">
								<thead>
									<tr>
										<th>#</th>
										<th>üìÖ Ng√†y Gi·ªù</th>
										<th>‚úÖ S·ªë C√¢u ƒê√∫ng</th>
										<th>‚ùå S·ªë C√¢u Sai</th>
										<th>üìã T·ªïng S·ªë C√¢u</th>
									</tr>
								</thead>
								<tbody>
									<tr>
										<td>1</td>
										<td>01/04/2025 - 14:30</td>
										<td><span class="highlight text-correct">80</span></td>
										<td><span class="highlight text-wrong">20</span></td>
										<td>100</td>
									</tr>
								</tbody>
							</table>
						</div>

					</div>
				</section>

				<section class="user-password user-maincontent"
					style="display: none;">
					<div class="user-info-container">
						<div class="user-info-header">
							<h3>ƒê·ªïi m·∫≠t kh·∫©u</h3>
						</div>


						<div th:if="${successMessage}"
							style="color: green; margin-bottom: 10px;">
							<p th:text="${successMessage}"></p>
						</div>
						<div th:if="${errorMessage}"
							style="color: red; margin-bottom: 10px;">
							<p th:text="${errorMessage}"></p>
						</div>


						<form action="/user/account-information/update-password"
							method="POST">
							<input type="hidden" name="_csrf" th:value="${_csrf.token}" />
							<div class="div">

								<label for="oldPassword">M·∫≠t kh·∫©u c≈©</label> <input
									type="password" id="oldPassword" name="oldPassword"
									placeholder="Nh·∫≠p m·∫≠t kh·∫©u c≈©" required>
							</div>
							<div class="div">
								<label for="newPassword">M·∫≠t kh·∫©u m·ªõi</label> <input
									type="password" id="newPassword" name="newPassword"
									placeholder="Nh·∫≠p m·∫≠t kh·∫©u m·ªõi" required>
							</div>
							<div class="div">
								<label for="confirmPassword">X√°c nh·∫≠n m·∫≠t kh·∫©u</label> <input
									type="password" id="confirmPassword" name="confirmPassword"
									placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi" required>
							</div>
							<div class="div">
								<button class="update" type="submit">C·∫≠p nh·∫≠t</button>
							</div>
						</form>

					</div>
				</section>
				<form id="avatarForm"
					th:action="@{/user/account-information/update-avatar}"
					method="post" enctype="multipart/form-data" style="display: none;">
					<input type="file" name="avatarFile" id="avatarInput"
						accept="image/*" onchange="uploadAvatar()">
				</form>
				<section class="user-avatar">
					<div>
						<div>
							<div class="avatar-edit">
								<img th:src="${currentUserAvatarUrl}" alt="avatar"><label
									for="avatarInput" class="edit">Edit <i
									class="fa fa-user-edit"></i>
								</label>
							</div>
						</div>
					</div>
				</section>

			</div>
		</div>
	</main>
	<script>
		function uploadAvatar() {
			document.getElementById("avatarForm").submit();
		}
	</script>

	<script>
		function uploadAvatar() {
			document.getElementById("avatarForm").submit();
		}

		document.addEventListener("DOMContentLoaded", function() {
			const params = new URLSearchParams(window.location.search);
			if (params.has("changepass")) {
				showSection('.user-password');
			}
		});
	</script>

</body>
</html>